#!/usr/bin/env bash
for file in $SSHHOME/.sshrc.d/sources/*.sh; do
    source "$file"
done

export PATH="$SSHHOME/.sshrc.d/bin:$PATH"

# assuming bash from here since that's the default on most servers
# could make work with either someday if desired

export HISTCONTROL='ignoreboth'
export HISTTIMEFORMAT="[%F %T %z] "
export HISTSIZE=100000

# SHOPTS
shopt -s histappend
shopt -s dotglob
shopt -s globstar
shopt -s autocd
shopt -s expand_aliases

# configure prompt
export PROMPT_SHORT_DISPLAY=1

# register command prompt (prompt.sh)
register_prompt

# override prompt precmd (prompt.sh)
_prompt_precmd() {
    # set tab title to the current directory
    # http://tldp.org/HOWTO/Xterm-Title-4.html
    echo -n "\\[$(tabtitle '\w')\\]"
}

# source my bash_profile even when su-ing, derived from http://superuser.com/a/636475
# note: doesn't work if user you su to has PROMPT_COMMAND set. Not sure of workaround
alias sudosu="export PROMPT_COMMAND='source $SSHHOME/.sshrc; $PROMPT_COMMAND' && sudo -E su"

# bind my keyboard shortcuts even when su-d
if [[ $USER != "$(logname)" ]]; then
    bind -f "$SSHHOME/.sshrc.d/.inputrc"
fi

# 3rd party
eval "$(fasd --init auto)"

prompt_ensure_save_return_code  # (prompt.sh)
